// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    // NOTE: When using mysql or sqlserver, uncomment the @db.Text annotations in model Account below
    // Further reading:
    // https://next-auth.js.org/adapters/prisma#create-the-prisma-schema
    // https://www.prisma.io/docs/reference/api-reference/prisma-schema-reference#string
    url      = env("DATABASE_URL")
}

model SinkFeedback {
    id        String       @id @default(cuid())
    sinkId    String
    sink      Sink         @relation(fields: [sinkId], references: [id], onDelete: Cascade)
    type      FeedbackType
    message   String       @db.Text
    rating    Int? // 1-5 estrelas (opcional)
    name      String? // Nome opcional do usuário
    email     String? // Email opcional do usuário
    createdAt DateTime     @default(now())
    updatedAt DateTime     @default(now()) @updatedAt
}

model UserConfiguration {
    id String @id @default(cuid())

    notifications Json
    security      Json

    createdAt DateTime @default(now())
    updatedAt DateTime @default(now()) @updatedAt
}

model SinkMaintanceService {
    id Int @id @default(autoincrement())

    name String

    createdAt DateTime @default(now())
    updatedAt DateTime @default(now()) @updatedAt

    sinkMaintances SinkMaintance[]
}

enum SinkMaintanceStatus {
    PENDING
    IN_PROGRESS
    CONCLUDED
}

model SinkMaintance {
    id String @id @default(cuid())

    responsableId String
    responsable   User   @relation(fields: [responsableId], references: [id])

    sinkId String
    sink   Sink   @relation(fields: [sinkId], references: [id])

    observations String?             @db.VarChar(255)
    status       SinkMaintanceStatus @default(PENDING)

    createdAt DateTime @default(now())
    updatedAt DateTime @default(now()) @updatedAt

    sinkMaintanceServices SinkMaintanceService[]
}

enum SinkStatus {
    ACTIVE
    INACTIVE
    MAINTANCE
}

model Sink {
    id          String     @id @default(cuid())
    name        String
    location    String
    description String
    status      SinkStatus @default(ACTIVE)

    createdAt      DateTime        @default(now())
    updatedAt      DateTime        @default(now()) @updatedAt
    sinkMaintances SinkMaintance[]
    feedbacks      SinkFeedback[]
}

enum FeedbackType {
    PROBLEM
    SUGGESTION
    COMPLIMENT
    OTHER
}

// Better Auth models
// Account model mantido para compatibilidade, mas não será usado com credentials

enum UserRole {
    ADMIN
    WORKER
}

model User {
    id             String          @id
    name           String
    email          String
    role           UserRole        @default(ADMIN)
    emailVerified  Boolean         @default(false)
    image          String?
    createdAt      DateTime        @default(now())
    updatedAt      DateTime        @default(now()) @updatedAt
    sessions       Session[]
    accounts       Account[]
    sinkMaintances SinkMaintance[]

    @@unique([email])
    @@map("user")
}

model Session {
    id        String   @id
    expiresAt DateTime
    token     String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    ipAddress String?
    userAgent String?
    userId    String
    user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@unique([token])
    @@map("session")
}

model Account {
    id                    String    @id
    accountId             String
    providerId            String
    userId                String
    user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
    accessToken           String?
    refreshToken          String?
    idToken               String?
    accessTokenExpiresAt  DateTime?
    refreshTokenExpiresAt DateTime?
    scope                 String?
    password              String?
    createdAt             DateTime  @default(now())
    updatedAt             DateTime  @updatedAt

    @@map("account")
}

model Verification {
    id         String   @id
    identifier String
    value      String
    expiresAt  DateTime
    createdAt  DateTime @default(now())
    updatedAt  DateTime @default(now()) @updatedAt

    @@map("verification")
}
